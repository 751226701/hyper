<include file="public@header"/>
</head>
<body>
<div class="layui-fluid">
    <div class="layui-row">
        <div class="layui-card">
            <div class="layui-tab layui-tab-brief">
                <ul class="layui-tab-title">
                    <li class="layui-this"><a href="{:url('AdminPage/index')}">页面管理</a></li>
                    <li><a href="{:url('AdminPage/add')}">添加页面</a></li>
                </ul>
                <div class="layui-tab-content">
                    <!-- 搜索表单 -->
                    <form class="layui-form layui-form-pane" method="get" action="{:url('AdminPage/index')}">
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                    <input type="text" class="layui-input" name="keyword" value="{$keyword|default=''}" 
                                           placeholder="请输入关键字">
                            </div>
                            <div class="layui-inline">
                                <button type="submit" class="layui-btn">
                                    <i class="layui-icon layui-icon-search"></i>{:lang('Search')}
                                </button>
                            </div>
                        </div>
                    </form>

                    <!-- 数据表格 -->
                    <form class="js-ajax-form layui-form" method="post">
                        <div class="layui-btn-group">
                            <button class="layui-btn layui-btn-xs layui-btn-danger js-ajax-submit" type="submit" 
                                    data-action="{:url('AdminPage/delete')}" data-subcheck="true" 
                                    data-msg="{:lang('DELETE_CONFIRM_MESSAGE')}">
                                <i class="layui-icon layui-icon-delete"></i> {:lang('DELETE')}
                            </button>
                        </div>
                        
                        <table class="layui-table">
                            <thead>
                                <tr>
                                    <th width="16">
                                        <input type="checkbox" lay-skin="primary" lay-filter="allChoose" 
                                               class="js-check-all" data-direction="x" data-checklist="js-check-x">
                                    </th>
                                    <th>标题</th>
                                    <th width="80">作者</th>
                                    <th width="160">发布时间</th>
                                    <th width="80">状态</th>
                                    <th width="150">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                            <php>$status=array("1"=>'已发布',"0"=>'未发布');</php>
                            <foreach name="pages" item="vo">
                                <tr>
                                    <td title="ID:{$vo.id}">
                                        <input type="checkbox" lay-skin="primary" class="js-check" 
                                               data-yid="js-check-y" data-xid="js-check-x" name="ids[]" value="{$vo.id}">
                                    </td>
                                    <td>
                                        <a href="{:cmf_url('portal/Page/index',array('id'=>$vo['id']))}" target="_blank">
                                            {$vo.post_title}
                                        </a>
                                    </td>
                                    <td>{$vo.user_nickname}</td>
                                    <td>
                                        <empty name="vo.published_time">
                                            未发布
                                        <else/>
                                            {:date('Y-m-d H:i',$vo['published_time'])}
                                        </empty>
                                    </td>
                                    <td>
                                        <notempty name="vo.post_status">
                                            <span class="layui-badge layui-bg-green">已发布</span>
                                        <else/>
                                            <span class="layui-badge layui-bg-orange">未发布</span>
                                        </notempty>
                                    </td>
                                    <td>
                                        <a class="layui-btn layui-btn-xs layui-btn-normal" href="{:url('AdminPage/edit',array('id'=>$vo['id']))}">
                                            <i class="layui-icon layui-icon-edit"></i>
                                        </a>
                                        
                                        <a class="layui-btn layui-btn-xs layui-btn-danger js-ajax-delete"
                                            href="{:url('AdminPage/delete',array('id'=>$vo['id']))}">
                                            <i class="layui-icon layui-icon-delete"></i>
                                        </a>
                                    </td>
                                </tr>
                            </foreach>
                            </tbody>
                        </table>
                        <div id="pagination">{$page}</div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="__STATIC__/js/admin.js?v={$_static_version}"></script>
<script>
layui.use(['form'], function(){
    var form = layui.form;
    
    // 全选
    form.on('checkbox(allChoose)', function(data){
        var child = $(data.elem).closest('table').find('tbody input[type="checkbox"]');
        child.each(function(index, item){
            item.checked = data.elem.checked;
        });
        form.render('checkbox');
    });
    
    // 给所有checkbox添加lay-skin属性
    $('input[type="checkbox"]').attr('lay-skin', 'primary');
    
    // 给所有js-check类的checkbox添加lay-filter属性
    $('.js-check').attr('lay-filter', 'itemChoose');
    
    // 重新渲染表单元素
    form.render();
});

function openPortalPageEditDialog(obj) {
    var $obj = $(obj);
    var href = $obj.data('href');
    parent.openIframeLayer(href, '编辑页面', {
        area: GV.IS_MOBILE ? ['100%', '100%'] : ['95%', '95%'],
        offset: GV.IS_MOBILE ? ['0px', '0px'] : 'auto',
        end: function () {
            location.reload();
        }
    });
}
</script>
<style>
/* 移除选项卡边框 */
.layui-tab {
    margin: 0;
}
.layui-tab-brief > .layui-tab-title {
    border-bottom-color: #f6f6f6;
}

/* 调整表格样式 */
.layui-table {
    margin: 10px 0;
}

/* 调整分页样式 */
#pagination {
    margin-top: 10px;
    text-align: center;
}

/* 调整按钮组样式 */
.layui-btn-group {
    margin: 10px 0;
}

/* 调整搜索表单样式 */
.layui-form-pane {
    margin-bottom: 0;
}
</style>
</body>
</html>
