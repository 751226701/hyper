<!--
 * @Desc: RBAC权限分配
 * @Author: Patrick Star
 * @Date: 2024-12-16 16:59:34
-->
<include file="public@header" />
</head>

<body>
    <div class="layui-fluid">
        <div class="layui-row">
            <div class="layui-card">
                <div class="layui-tab layui-tab-brief">
                    <ul class="layui-tab-title">
                        <li><a href="{:url('rbac/index')}">{:lang('ADMIN_RBAC_INDEX')}</a></li>
                        <li class="layui-this">{:lang('ADMIN_RBAC_AUTHORIZE')}</li>
                    </ul>
                    <div class="layui-tab-content">
                        <form class="js-ajax-form margin-top-20" action="admin/roles/{$role_id}/authorize" method="put">
                            <div class="table_full">
                                <table class="table table-bordered" id="authrule-tree">
                                    <tbody>
                                        {$category}
                                    </tbody>
                                </table>
                            </div>
                            <div class="layui-form-item">
                                    <input type="hidden" name="roleId" value="{$roleId}">
                                    <button type="submit" class="layui-btn layui-btn-fluid js-ajax-submit" data-refresh="1">
                                        <i class="layui-icon layui-icon-auz"></i>{:lang('SAVE')}
                                    </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="__STATIC__/js/admin.js?v={$_static_version}"></script>
    <block name="scripts">
        <script type="text/javascript">
            $(document).ready(function () {
                Wind.css('treeTable');
                Wind.use('treeTable', function () {
                    $("#authrule-tree").treeTable({
                        indent: 20
                    });
                });
                $("#authrule-tree input[name='menuId[]']").each(function () {
                    $(this).attr('name', 'ids[]');
                })
            });

            function checknode(obj) {
                var chk = $("input[type='checkbox']");
                var count = chk.length;

                var num = chk.index(obj);
                var level_top = level_bottom = chk.eq(num).attr('level');
                for (var i = num; i >= 0; i--) {
                    var le = chk.eq(i).attr('level');
                    if (le < level_top) {
                        chk.eq(i).prop("checked", true);
                        var level_top = level_top - 1;
                    }
                }
                for (var j = num + 1; j < count; j++) {
                    var le = chk.eq(j).attr('level');
                    if (chk.eq(num).prop("checked")) {

                        if (le > level_bottom) {
                            chk.eq(j).prop("checked", true);
                        } else if (le == level_bottom) {
                            break;
                        }
                    } else {
                        if (le > level_bottom) {
                            chk.eq(j).prop("checked", false);
                        } else if (le == level_bottom) {
                            break;
                        }
                    }
                }
            }
        </script>
    </block>