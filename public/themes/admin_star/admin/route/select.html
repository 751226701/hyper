<!--
 * @Desc: Select route
 * @Author: Patrick Star
 * @Date: 2024-12-16 16:59:34
-->
<include file="public@header"/>
<block name="head">
    <php>
        if (!function_exists('_suggest_url')) {
            function _suggest_url($action, $url) {
                $actionArr = explode('/', $action);
                $params = array_keys($url['vars']);
                $urlDepr1Params = [];
                $urlDepr2Params = [];
                
                if (!empty($params)) {
                    foreach ($params as $param) {
                        if(empty($url['vars'][$param]['require'])){
                            array_push($urlDepr1Params, "[:$param]");
                        }else{
                            array_push($urlDepr1Params, ":$param");
                        }
                        array_push($urlDepr2Params, htmlspecialchars('<') . $param . htmlspecialchars('>'));
                    }
                }

                if ($actionArr[2] == 'index') {
                    $actionArr[1] = cmf_parse_name($actionArr[1]);
                    return empty($params) ? $actionArr[1].'$' : ($actionArr[1] . '/' . implode('/', $urlDepr1Params));
                } else {
                    $actionArr[2] = cmf_parse_name($actionArr[2]);
                    return empty($params) ? $actionArr[2].'$' : ($actionArr[2] . '/' . implode('/', $urlDepr1Params));
                }
            }
        }

        if (!function_exists('_url_vars')) {
            function _url_vars($url) {
                if (!empty($url['vars'])) {
                    return implode(',', array_keys($url['vars']));
                }
                return '';
            }
        }
    </php>
</block>
</head>
<body>
<div class="layui-fluid">
    <div class="layui-row">
        <div class="layui-card">
            <div class="layui-card-body">
                <table class="layui-table">
                    <thead>
                        <tr>
                            <th width="50"></th>
                            <th width="100">URL</th>
                            <th>{:lang('Name')}</th>
                            <th>{:lang('Route Parameters')}</th>
                            <th>{:lang('Route Suggestion')}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <foreach name="urls" item="vo" key="action">
                            <php>$suggestUrl=_suggest_url($action,$vo);</php>
                            <tr>
                                <td>
                                    <input type="radio" name="ids[]" lay-skin="primary" value="" 
                                            data-name="{$vo.name}" data-action="{$action}" 
                                            data-url="{$suggestUrl}" data-vars="{:_url_vars($vo)}">
                                </td>
                                <td>{$action}</td>
                                <td>{$vo.name}</td>
                                <td>
                                    <notempty name="vo.vars">
                                        {:_url_vars($vo)}
                                    </notempty>
                                </td>
                                <td>{$suggestUrl}</td>
                            </tr>
                        </foreach>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script src="__STATIC__/js/admin.js?v={$_static_version}"></script>
<script>
layui.use(['form'], function(){
    var form = layui.form;
    
    // 点击行选中radio
    $(document).on('click', 'tr', function(e) {
        if (!$(e.target).is('input[type="radio"]')) {
            $(this).find('input[type="radio"]').prop('checked', true);
            form.render('radio');
        }
    });
});

function confirm() {
    var $url = $('input[type="radio"]:checked');
    if ($url.length > 0) {
        return {
            action: $url.data('action'),
            name: $url.data('name'),
            url: $url.data('url'),
            vars: $url.data('vars')
        };
    }
    return false;
}
</script>
</body>
</html>